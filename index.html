<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Real-time busyness tracking for Edinburgh and Glasgow. Find the best time to swim." />
  <meta name="keywords" content="Edinburgh pools, swimming, pool busyness, Edinburgh Leisure, Pool Pulse" />
  <title>Pool Pulse - Edinburgh and Glasgow Pool Busyness</title>

  <!-- Prevent favicon 404 noise -->
  <link rel="icon" href="data:," />

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <style>
    body { font-family: 'Manrope', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // -----------------------
    // Supabase
    // -----------------------
    const SUPABASE_URL = "https://hygjskvfkucuwtcihbiw.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5Z2pza3Zma3VjdXd0Y2loYml3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNjQ4OTMsImV4cCI6MjA4Njg0MDg5M30.SSrSE9J9-hs0kZNIzUMBCPST5T_JXZG5I68UF4ZjgLs";
    const supa = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    window.supa = supa; // handy for debugging in console

    // -----------------------
    // Icons (Lucide)
    // -----------------------
const Droplets = (props) => <span {...props}>üíß</span>;
const Users = (props) => <span {...props}>üë•</span>;
const Clock = (props) => <span {...props}>‚è∞</span>;
const MapPin = (props) => <span {...props}>üìç</span>;
const ArrowLeft = (props) => <span {...props}>‚¨ÖÔ∏è</span>;
const Activity = (props) => <span {...props}>üìä</span>;
const Waves = (props) => <span {...props}>üåä</span>;
const APP_LOGO = "./assets/poolpulse_app_icon_color.svg";

const LogoMark = ({ className = "" }) => (
  <img
    src={APP_LOGO}
    alt="Pool Pulse"
    className={`w-full h-full object-contain ${className}`.trim()}
  />
);
    // -----------------------
    // Data
    // -----------------------
    const POOLS = [
      {
        id: "royal-commonwealth",
        name: "Royal Commonwealth Pool",
        location: "Dalkeith Road",
        color: "#0EA5E9",
        hours: {
          weekday: { open: "05:30", close: "22:00" },
          saturday: { open: "05:30", close: "20:00" },
          sunday: { open: "07:30", close: "20:00" },
          wednesdayClosed: { start: "09:00", end: "10:00" },
        },
      },
      {
        id: "warrender",
        name: "Warrender Swim Centre",
        location: "Thirlestane Road",
        color: "#8B5CF6",
        hours: {
          weekday: { open: "06:30", close: "21:30" },
          saturday: { open: "08:00", close: "17:00" },
          sunday: { open: "08:00", close: "17:00" },
        },
      },
      {
        id: "glenogle",
        name: "Glenogle Swim Centre",
        location: "Glenogle Road",
        color: "#10B981",
        hours: {
          weekday: { open: "06:30", close: "21:30" },
          saturday: { open: "08:00", close: "17:00" },
          sunday: { open: "08:00", close: "17:00" },
        },
      },
      {
        id: "leith-victoria",
        name: "Leith Victoria Swim Centre",
        location: "Junction Place",
        color: "#F59E0B",
        hours: {
          weekday: { open: "06:30", close: "21:30" },
          saturday: { open: "08:00", close: "17:00" },
          sunday: { open: "08:00", close: "17:00" },
        },
      },
      {
        id: "dalry",
        name: "Dalry Swim Centre",
        location: "Caledonian Crescent",
        color: "#EF4444",
        hours: {
          weekday: { open: "06:30", close: "21:30" },
          saturday: { open: "08:00", close: "17:00" },
          sunday: { open: "08:00", close: "17:00" },
        },
      },
      {
        id: "portobello",
        name: "Portobello Swim Centre",
        location: "Bellfield Street",
        color: "#EC4899",
        hours: {
          weekday: { open: "06:30", close: "21:30" },
          saturday: { open: "08:00", close: "17:00" },
          sunday: { open: "08:00", close: "17:00" },
        },
      },
      {
        id: "ainslie-park",
        name: "Ainslie Park Leisure Centre",
        location: "Pilton Drive",
        color: "#6366F1",
        hours: {
          weekday: { open: "06:30", close: "21:30" },
          saturday: { open: "08:00", close: "17:00" },
          sunday: { open: "08:00", close: "17:00" },
        },
      },
      {
        id: "glasgow-club-bellahouston",
        name: "Glasgow Club Bellahouston",
        location: "Glasgow (Bellahouston)",
        color: "#14B8A6",
        hours: {
          weekday: { open: "06:00", close: "22:00" },
          saturday: { open: "08:00", close: "18:00" },
          sunday: { open: "08:00", close: "20:00" },
        },
      },
      {
        id: "glasgow-club-castlemilk",
        name: "Glasgow Club Castlemilk",
        location: "Glasgow (Castlemilk)",
        color: "#F97316",
        hours: {
          weekday: { open: "08:00", close: "20:00" },
          saturday: { open: "09:00", close: "17:00" },
          sunday: { open: "10:00", close: "17:00" },
        },
      },
      {
        id: "glasgow-club-easterhouse",
        name: "Glasgow Club Easterhouse",
        location: "Glasgow (Easterhouse)",
        color: "#38BDF8",
        hours: {
          monday: { open: "09:00", close: "14:30" },
          tuesday: { open: "14:30", close: "20:00" },
          wednesday: { open: "09:00", close: "14:30" },
          thursday: { open: "14:30", close: "20:00" },
          friday: { open: "09:00", close: "14:30" },
          saturday: { open: "09:00", close: "16:00" },
          sunday: { closed: true },
        },
      },
      {
        id: "glasgow-club-gorbals",
        name: "Glasgow Club Gorbals",
        location: "Glasgow (Gorbals)",
        color: "#F43F5E",
        hours: {
          weekday: { open: "06:00", close: "22:00" },
          saturday: { open: "08:00", close: "18:00" },
          sunday: { open: "08:00", close: "20:00" },
        },
      },
      {
        id: "glasgow-club-north-woodside",
        name: "Glasgow Club North Woodside",
        location: "Glasgow (North Woodside)",
        color: "#8B5CF6",
        hours: {
          monday: { open: "15:00", close: "21:00" },
          tuesday: { open: "10:00", close: "15:00" },
          wednesday: { open: "10:00", close: "15:00" },
          thursday: { open: "15:00", close: "21:00" },
          friday: { open: "10:00", close: "15:00" },
          saturday: { open: "09:00", close: "18:00" },
          sunday: { closed: true },
        },
      },
      {
        id: "glasgow-club-scotstoun",
        name: "Glasgow Club Scotstoun",
        location: "Glasgow (Scotstoun)",
        color: "#0EA5E9",
        hours: {
          weekday: { open: "06:00", close: "22:00" },
          saturday: { open: "08:00", close: "18:00" },
          sunday: { open: "08:00", close: "20:00" },
        },
      },
      {
        id: "glasgow-club-springburn",
        name: "Glasgow Club Springburn",
        location: "Glasgow (Springburn)",
        color: "#10B981",
        hours: {
          weekday: { open: "06:00", close: "21:00" },
          saturday: { open: "08:00", close: "16:00" },
          sunday: { open: "08:00", close: "16:00" },
        },
      },
      {
        id: "tollcross-international-swimming-centre",
        name: "Tollcross International Swimming Centre",
        location: "Glasgow (Tollcross)",
        color: "#06B6D4",
        hours: {
          weekday: { open: "06:00", close: "22:00" },
          saturday: { open: "08:00", close: "18:00" },
          sunday: { open: "08:00", close: "20:00" },
        },
      },
      {
        id: "glasgow-club-whitehill",
        name: "Glasgow Club Whitehill",
        location: "Glasgow (Whitehill)",
        color: "#84CC16",
        hours: {
          monday: { closed: true },
          tuesday: { closed: true },
          wednesday: { closed: true },
          thursday: { closed: true },
          friday: { closed: true },
          saturday: { closed: true },
          sunday: { closed: true },
        },
      },
      {
        id: "western-baths-club",
        name: "Western Baths Club",
        location: "Glasgow (Hillhead / West End)",
        color: "#A855F7",
        hours: {
          weekday: { open: "06:00", close: "21:30" },
          saturday: { open: "07:00", close: "19:30" },
          sunday: { open: "08:00", close: "18:30" },
        },
      },
    ];

    const LANES = [
      { id: "fast", label: "Fast Lane", icon: "üèÉ", color: "bg-red-100 border-red-300 text-red-800" },
      { id: "medium", label: "Medium Lane", icon: "üö∂", color: "bg-yellow-100 border-yellow-300 text-yellow-800" },
      { id: "slow", label: "Slow Lane", icon: "üê¢", color: "bg-green-100 border-green-300 text-green-800" },
    ];

    const laneLabel = (laneId) => {
      const l = LANES.find((x) => x.id === laneId);
      return l ? l.label : laneId;
    };

    // -----------------------
    // App
    // -----------------------
    function PoolBusynessTracker() {
      // Core UI state
      const [poolData, setPoolData] = useState({});
      const [selectedPool, setSelectedPool] = useState("");
      const [selectedLane, setSelectedLane] = useState("");

      // Reset lane whenever pool changes (prevents accidental check-ins when switching pools)
      useEffect(() => {
        setSelectedLane("");
      }, [selectedPool]);
      const [showSuccess, setShowSuccess] = useState(false);
      const [loading, setLoading] = useState(true);
      const [viewingPool, setViewingPool] = useState(null);

      const [showHomepage, setShowHomepage] = useState(true);
      const [showPrivacyPolicy, setShowPrivacyPolicy] = useState(false);
      const [showTerms, setShowTerms] = useState(false);

      // Pools list filters (beta)
      const [openNowOnly, setOpenNowOnly] = useState(true);
      const [cityFilter, setCityFilter] = useState("All");

      // Feedback form
      const FEEDBACK_EMAIL = "snehasindhu2109@gmail.com";
      const [feedbackType, setFeedbackType] = useState("general");
      const [feedbackMessage, setFeedbackMessage] = useState("");
      const [feedbackContact, setFeedbackContact] = useState("");
      const [feedbackSent, setFeedbackSent] = useState(false);
      const [feedbackSubmitting, setFeedbackSubmitting] = useState(false);
      const [feedbackError, setFeedbackError] = useState("");
      const [feedbackFallbackHref, setFeedbackFallbackHref] = useState("");

      // Supabase check-ins state
      const CHECKIN_WINDOW_MINUTES = 75; // short-lived check-ins
      const [recentCheckins, setRecentCheckins] = useState([]);
      const [checkinsLoading, setCheckinsLoading] = useState(true);
      const [checkinsError, setCheckinsError] = useState(null);
const getPoolById = (id) => POOLS.find((p) => p.id === id);
  const selectedPoolObj = selectedPool ? getPoolById(selectedPool) : null;
  const selectedPoolIsOpen = selectedPoolObj ? isPoolOpen(selectedPoolObj) : false;

  const formatTime = (iso) => new Date(iso).toLocaleString();

  const checkinsForPool = (poolId) =>
    recentCheckins.filter((c) => c.pool_id === poolId).slice(0, 10);

  const buildStatusFromRecent = (poolId) => {
    const rows = checkinsForPool(poolId);
    if (!rows || rows.length === 0) return null;

    const status = { lanes: {}, totalUpdates: 0, lastUpdate: null };

    for (const r of rows) {
      const laneId = r.lane;
      const delta = typeof r.delta === "number" ? r.delta : 1;
      const ts = r.created_at;

      if (!status.lanes[laneId]) status.lanes[laneId] = { checkInCount: 0, lastUpdate: null };
      status.lanes[laneId].checkInCount += delta;
      status.totalUpdates += delta;

      if (!status.lanes[laneId].lastUpdate || ts > status.lanes[laneId].lastUpdate) status.lanes[laneId].lastUpdate = ts;
      if (!status.lastUpdate || ts > status.lastUpdate) status.lastUpdate = ts;
    }

    return status;
  };

const loadRecentCheckins = async ({ silent = false } = {}) => {
  if (!silent) {
    setCheckinsLoading(true);
  }

  // Only show check-ins from the last CHECKIN_WINDOW_MINUTES
  const sinceIso = new Date(
    Date.now() - CHECKIN_WINDOW_MINUTES * 60 * 1000
  ).toISOString();

  const { data, error } = await window.supa
    .from("checkins")
    .select("id, created_at, pool_id, lane, delta")
    .gte("created_at", sinceIso)
    .order("created_at", { ascending: false })
    .limit(50);

  if (error) {
    console.error("loadRecentCheckins error:", error);
    setCheckinsError(error.message);
    setRecentCheckins([]);
  } else {
    setCheckinsError(null);
    setRecentCheckins(data ?? []);
  }

  if (!silent) {
    setCheckinsLoading(false);
  }
};

const submitFeedback = async (e) => {
  e.preventDefault();

  if (!feedbackMessage.trim()) {
    return;
  }

  setFeedbackSubmitting(true);
  setFeedbackSent(false);
  setFeedbackError("");
  setFeedbackFallbackHref("");

  const payload = {
    type: feedbackType,
    message: feedbackMessage.trim(),
    contact: feedbackContact.trim() || null,
  };

  const { error } = await window.supa
    .from("feedback")
    .insert(payload);

  if (error) {
    console.error("submitFeedback error:", error);
    const subject = `[Pool Pulse feedback] ${feedbackType}`;
    const body = [
      `Type: ${feedbackType}`,
      "",
      feedbackMessage.trim(),
      "",
      `Contact: ${feedbackContact.trim() || "(not provided)"}`,
    ].join("\n");
    const mailtoHref = `mailto:${FEEDBACK_EMAIL}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

    setFeedbackFallbackHref(mailtoHref);
    setFeedbackError(`Sorry, we couldn't send your feedback right now (${error.message || "unknown error"}). Please try again or email ${FEEDBACK_EMAIL}.`);
    setFeedbackSubmitting(false);
    return;
  }

  setFeedbackSent(true);
  setFeedbackMessage("");
  setFeedbackContact("");
  setFeedbackSubmitting(false);
};

      const loadData = async ({ silent = false } = {}) => {
        try {
          if (!silent) {
            setLoading(true);
          }

          const sinceIso = new Date(
            Date.now() - CHECKIN_WINDOW_MINUTES * 60 * 1000
          ).toISOString();

          const { data, error } = await window.supa
            .from("checkins")
            .select("pool_id,lane,delta,created_at")
            .gte("created_at", sinceIso);

          if (error) throw error;

          const agg = {};

          for (const row of data || []) {
            const poolId = row.pool_id;
            const laneId = row.lane;
            const delta = typeof row.delta === "number" ? row.delta : 1;
            const ts = row.created_at;

            if (!agg[poolId]) agg[poolId] = { lanes: {}, totalUpdates: 0, lastUpdate: null };
            agg[poolId].totalUpdates += delta;

            if (!agg[poolId].lanes[laneId]) agg[poolId].lanes[laneId] = { checkInCount: 0, lastUpdate: null };
            agg[poolId].lanes[laneId].checkInCount += delta;

            if (!agg[poolId].lanes[laneId].lastUpdate || ts > agg[poolId].lanes[laneId].lastUpdate) {
              agg[poolId].lanes[laneId].lastUpdate = ts;
            }
            if (!agg[poolId].lastUpdate || ts > agg[poolId].lastUpdate) {
              agg[poolId].lastUpdate = ts;
            }
          }

          setPoolData(agg);
        } catch (e) {
          console.error("loadData error:", e);
        } finally {
          if (!silent) {
            setLoading(false);
          }
        }
      };

      useEffect(() => {
        loadData();
        loadRecentCheckins();

        const t = setInterval(() => {
          loadData({ silent: true });
          loadRecentCheckins({ silent: true });
        }, 10000);

        return () => clearInterval(t);
      }, []);
      // Handle browser back button
useEffect(() => {
  const handlePopState = () => {
    setShowHomepage(true);
    setShowPrivacyPolicy(false);
    setShowTerms(false);
    setViewingPool(null);
  };

  window.addEventListener('popstate', handlePopState);
  return () => window.removeEventListener('popstate', handlePopState);
}, []);
      
   // Re-render Lucide icons after React updates
useEffect(() => {
  if (window.lucide && window.lucide.createIcons) {
    try {
      window.lucide.createIcons();
    } catch (e) {
      console.error("Lucide error:", e);
    }
  }
}, []);

      const savePoolUpdate = async (poolId, lane) => {
        // UX throttling: 1 check-in per hour per browser (server-side controls still required)
        const lastCheckInKey = "lastCheckIn";
        const lastCheckIn = localStorage.getItem(lastCheckInKey);

        if (lastCheckIn) {
          const timeSinceLastCheckIn = Date.now() - parseInt(lastCheckIn, 10);
          const oneHour = 60 * 60 * 1000;

          if (timeSinceLastCheckIn < oneHour) {
            const minutesLeft = Math.ceil((oneHour - timeSinceLastCheckIn) / 60000);
            alert(`Please wait ${minutesLeft} minutes before checking in again.`);
            return;
          }
        }

        try {
          const { error } = await window.supa
            .from("checkins")
            .insert([{ pool_id: poolId, lane, delta: 1 }]);

          if (error) throw error;

          localStorage.setItem(lastCheckInKey, Date.now().toString());

          setShowSuccess(true);
          setTimeout(() => setShowSuccess(false), 2000);

          setSelectedPool("");
          setSelectedLane("");

          await Promise.all([loadData(), loadRecentCheckins()]);
        } catch (e) {
          console.error("insert error:", e);
          alert("Failed to save check-in. Please try again.");
        }
      };

     const handleSubmit = () => {
  if (!selectedPool || !selectedLane) return;

  const pool = POOLS.find((p) => p.id === selectedPool);
  if (!pool) return;

  if (!isPoolOpen(pool)) {
    alert(`${pool.name} is currently closed. Check-ins are disabled outside opening hours.`);
    return;
  }

  savePoolUpdate(selectedPool, selectedLane);
};

      const getTimeSince = (timestamp) => {
        if (!timestamp) return "No data yet";
        const now = new Date();
        const then = new Date(timestamp);
        const minutes = Math.floor((now - then) / 60000);

        if (minutes < 1) return "Just now";
        if (minutes < 60) return `${minutes}m ago`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours}h ago`;
        return `${Math.floor(hours / 24)}d ago`;
      };

      const getPoolStatus = (poolId) => {
        const data = poolData[poolId];
        if (!data || !data.lanes) return null;
        if (Object.keys(data.lanes).length === 0) return null;
        return data;
      };

      const cityOf = (pool) =>
        (pool.location || "").toLowerCase().includes("glasgow") ? "Glasgow" : "Edinburgh";

      const getOpenStatusText = (pool) => {
        const now = new Date();
        const day = now.getDay(); // 0 = Sunday, 6 = Saturday
        const currentTime = now.toTimeString().slice(0, 5);

        const hoursText = getOpeningHoursText(pool); // "HH:MM - HH:MM"
        if (hoursText === "Closed today") return "Closed today";
        const [open, close] = hoursText.split(" - ");

        // Handle Royal Commonwealth Wednesday training closure
        if (day === 3 && pool.hours.wednesdayClosed) {
          if (
            currentTime >= pool.hours.wednesdayClosed.start &&
            currentTime < pool.hours.wednesdayClosed.end
          ) {
            return `Closed ‚Äî reopens ${pool.hours.wednesdayClosed.end}`;
          }
        }

        return isPoolOpen(pool) ? `Open until ${close}` : `Closed ‚Äî opens ${open}`;
      };

      const getHoursForDay = (pool, day) => {
        const dayKeys = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];
        const specific = pool.hours[dayKeys[day]];
        if (specific) return specific;
        if (day === 0) return pool.hours.sunday;
        if (day === 6) return pool.hours.saturday;
        return pool.hours.weekday;
      };

      function isPoolOpen(pool) {
        const now = new Date();
        const day = now.getDay(); // 0 Sunday, 6 Saturday
        const currentTime = now.toTimeString().slice(0, 5);
        const hours = getHoursForDay(pool, day);

        if (!hours || hours.closed) return false;

        if (day === 3 && pool.hours.wednesdayClosed) {
          if (currentTime >= pool.hours.wednesdayClosed.start &&
              currentTime < pool.hours.wednesdayClosed.end) {
            return false;
          }
        }

        return currentTime >= hours.open && currentTime < hours.close;
      }

      const getOpeningHoursText = (pool) => {
        const now = new Date();
        const day = now.getDay();
        const hours = getHoursForDay(pool, day);

        if (!hours || hours.closed) return "Closed today";
        return `${hours.open} - ${hours.close}`;
      };

      // Map recent check-in counts into a friendly label
      const getLaneBusyness = (count) => {
        const c = count || 0;
        if (c === 0) return { label: "Empty", emoji: "üòä", bgColor: "bg-green-100", textColor: "text-green-800" };
        if (c <= 2) return { label: "Quiet", emoji: "üôÇ", bgColor: "bg-lime-100", textColor: "text-lime-800" };
        if (c <= 4) return { label: "Moderate", emoji: "üòê", bgColor: "bg-amber-100", textColor: "text-amber-800" };
        if (c <= 6) return { label: "Busy", emoji: "üò¨", bgColor: "bg-orange-100", textColor: "text-orange-800" };
        return { label: "Very Busy", emoji: "üò∞", bgColor: "bg-red-100", textColor: "text-red-800" };
      };

      // -----------------------
      // Privacy Policy View
      // -----------------------
      if (showPrivacyPolicy) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-teal-50 to-cyan-50">
            <div className="bg-[#043A3D] text-white shadow-lg">
              <div className="max-w-4xl mx-auto px-4 py-6">
                <button
                  onClick={() => { setShowPrivacyPolicy(false); setShowHomepage(true); }}
                  className="flex items-center gap-2 text-teal-100 hover:text-white mb-3 transition-colors"
                >
                  <ArrowLeft className="w-4 h-4" />
                  Back to home
                </button>
                <h1 className="text-3xl font-bold">Privacy Policy</h1>
              </div>
            </div>

            <div className="max-w-4xl mx-auto px-4 py-12">
              <div className="bg-white rounded-xl shadow-lg p-8">
                <p className="text-gray-600 mb-6">Last updated: February 20, 2026</p>

                <h2 className="text-2xl font-bold text-gray-900 mb-4">Privacy Policy</h2>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  Pool Pulse is designed to be privacy-first. We do not ask you to create an account, and check-ins are
                  submitted anonymously.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">Who we are</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  Pool Pulse (‚Äúwe‚Äù, ‚Äúus‚Äù) is an independent community project. Pool Pulse is not affiliated with, endorsed
                  by, or sponsored by Edinburgh Leisure or any pool operator.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">What data we collect</h3>
                <ul className="list-disc pl-6 text-gray-700 mb-6 leading-relaxed space-y-2">
                  <li>
                    <strong>Anonymous check-ins:</strong> pool identifier, lane type, a numeric ‚Äúdelta‚Äù (used to adjust
                    busyness), and a timestamp.
                  </li>
                  <li>
                    <strong>Basic technical data:</strong> like most websites, our hosting and infrastructure providers may
                    automatically receive standard log data (for example IP address, device/browser type, and request
                    metadata) for security and operational purposes.
                  </li>
                </ul>

                <h3 className="text-xl font-bold text-gray-900 mb-3">What we do not collect</h3>
                <ul className="list-disc pl-6 text-gray-700 mb-6 leading-relaxed space-y-2">
                  <li>No account credentials, profile accounts, or mandatory identity fields for browsing/check-ins.</li>
                  <li>No precise location tracking, GPS data, or background location access.</li>
                  <li>No cameras, biometrics, or surveillance.</li>
                </ul>

                <h3 className="text-xl font-bold text-gray-900 mb-3">How we use the data</h3>
                <p className="text-gray-700 mb-4 leading-relaxed">
                  We use anonymous check-ins to calculate and display lane busyness for pools, based on recent check-ins
                  from the last {CHECKIN_WINDOW_MINUTES} minutes.
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-6 leading-relaxed space-y-2">
                  <li>To show busyness snapshots (Quiet / OK / Busy) by lane type.</li>
                  <li>To show ‚ÄúUpdated X minutes ago‚Äù and recent check-in activity.</li>
                  <li>To maintain reliability, prevent abuse, and debug issues.</li>
                </ul>

                <h3 className="text-xl font-bold text-gray-900 mb-3">Legal basis (UK GDPR)</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  Where UK GDPR applies, we process anonymous check-in data on the basis of <strong>legitimate interests</strong>
                  (providing a community service and keeping it accurate), and process limited technical/log data for
                  <strong> security and service operation</strong>.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">Data retention</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  Check-ins are intended to be short-lived. The app‚Äôs busyness calculations use the most recent {CHECKIN_WINDOW_MINUTES} minutes of
                  activity. Infrastructure logs (if any) are retained by providers for limited periods according to their
                  standard practices.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">Feedback data</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  If you submit feedback, we store your feedback type, message, and any optional contact email you provide.
                  Optional contact details are only used to follow up on your feedback and are never sold.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">Sharing and processors</h3>
                <p className="text-gray-700 mb-4 leading-relaxed">
                  We do not sell your data. We use service providers to run Pool Pulse:
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-6 leading-relaxed space-y-2">
                  <li>
                    <strong>GitHub Pages</strong> for hosting the website.
                  </li>
                  <li>
                    <strong>Supabase</strong> to store anonymous check-ins and retrieve recent check-ins.
                  </li>
                </ul>

                <h3 className="text-xl font-bold text-gray-900 mb-3">Cookies and analytics</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  During the beta, Pool Pulse does not run Google Analytics (GA4) and does not set non-essential tracking
                  cookies. Some essential technical storage may be used by your browser (for example caching).
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">Security</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  We use reasonable technical measures to protect the service, but no internet transmission is 100% secure.
                  Please avoid submitting personal information in any free-text fields (if present in future versions).
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">Your rights</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  If any personal data is processed (for example in logs), you may have rights under UK data protection law,
                  including access, correction, deletion, and objection. Because check-ins are anonymous and we do not
                  collect identifiers, we may not be able to link records to a specific individual.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">Contact</h3>
                <p className="text-gray-700 leading-relaxed">
                  Questions or requests? Please contact the project maintainer via the Pool Pulse GitHub repository.
                </p>

              </div>
            </div>
          </div>
        );
      }

      // -----------------------
      // Terms View
      // -----------------------
      if (showTerms) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-teal-50 to-cyan-50">
            <div className="bg-[#043A3D] text-white shadow-lg">
              <div className="max-w-4xl mx-auto px-4 py-6">
                <button
                  onClick={() => { setShowTerms(false); setShowHomepage(true); }}
                  className="flex items-center gap-2 text-teal-100 hover:text-white mb-3 transition-colors"
                >
                  <ArrowLeft className="w-4 h-4" />
                  Back to home
                </button>
                <h1 className="text-3xl font-bold">Terms of Service</h1>
              </div>
            </div>

            <div className="max-w-4xl mx-auto px-4 py-12">
              <div className="bg-white rounded-xl shadow-lg p-8">
                <p className="text-gray-600 mb-6">Last updated: February 20, 2026</p>

                <h2 className="text-2xl font-bold text-gray-900 mb-4">Terms of Service</h2>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  Pool Pulse is a free, community-built tool that helps swimmers estimate lane busyness using anonymous
                  check-ins. By using the site, you agree to these Terms.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">1) Beta service</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  Pool Pulse is in beta. Features may change, and the service may be unavailable or interrupted from time
                  to time.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">2) No affiliation</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  Pool Pulse is not affiliated with, endorsed by, or sponsored by Edinburgh Leisure or any pool operator.
                  Opening times and availability may change without notice.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">3) Busyness estimates (no guarantees)</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  Busyness is estimated from recent community check-ins (last {CHECKIN_WINDOW_MINUTES} minutes). It may not reflect exact current
                  conditions. You should always use your own judgement when planning a visit.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">4) Acceptable use</h3>
                <ul className="list-disc pl-6 text-gray-700 mb-6 leading-relaxed space-y-2">
                  <li>Do not submit spam, fake, or malicious check-ins.</li>
                  <li>Do not attempt to disrupt or overload the service.</li>
                  <li>Do not reverse engineer, scrape excessively, or misuse the service.</li>
                </ul>

                <h3 className="text-xl font-bold text-gray-900 mb-3">5) Safety</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  Pool Pulse does not provide safety advice. Always follow pool rules, lifeguard instructions, and local
                  guidance.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">6) Intellectual property</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  The Pool Pulse name, logo, and site content are owned by Pool Pulse or its licensors. You may share links
                  to the site, but you must not use our branding in a way that suggests endorsement.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">7) Limitation of liability</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  To the fullest extent permitted by law, Pool Pulse is provided ‚Äúas is‚Äù and we exclude warranties and
                  liability for any loss or damage arising from your use of the site or reliance on busyness estimates.
                  Nothing in these Terms limits liability that cannot be limited under law.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">8) Changes</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  We may update these Terms from time to time. The ‚ÄúLast updated‚Äù date indicates the latest version.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">9) Governing law</h3>
                <p className="text-gray-700 mb-6 leading-relaxed">
                  These Terms are governed by the laws of Scotland, and the courts of Scotland will have jurisdiction,
                  subject to any mandatory consumer protections that apply.
                </p>

                <h3 className="text-xl font-bold text-gray-900 mb-3">Contact</h3>
                <p className="text-gray-700 leading-relaxed">
                  Questions or requests? Please contact the project maintainer via the Pool Pulse GitHub repository.
                </p>

              </div>
            </div>
          </div>
        );
      }

      // -----------------------
      // Homepage View
      // -----------------------
     if (showHomepage) {
  return (
    <div className="min-h-screen bg-gradient-to-br from-teal-50 via-cyan-50 to-blue-50">
      {/* Header */}
     <div className="bg-[#043A3D] text-white shadow-lg">
  <div className="max-w-4xl mx-auto px-4 py-8">
    <div className="flex items-center justify-center gap-4 mb-4">
      <div className="relative">
        <div className="absolute inset-0 bg-white/10 rounded-full blur-2xl"></div>

        {/* Logo container */}
        <div className="relative bg-white/5 backdrop-blur-sm p-2 rounded-3xl border border-white/10 shadow-2xl">
          <div className="w-14 h-14">
            <LogoMark />
          </div>
        </div>
      </div>

      <div className="text-center">
        <h1 className="text-4xl font-bold mb-1">Pool Pulse</h1>
        <p className="text-white/80 text-sm font-medium">Edinburgh & Glasgow</p>
      </div>
    </div>

    <p className="text-center text-white/85 text-lg max-w-4xl mx-auto">
      Know before you go! See how busy each lane is, based on anonymous check-ins.
    </p>
  </div>
</div>

<div className="max-w-4xl mx-auto px-4 py-12">
        {/* Main CTA */}
        <div className="bg-white rounded-2xl shadow-xl p-8 mb-8">
          <div className="text-center mb-8">
            <h2 className="text-3xl font-bold text-gray-900 mb-4">
              Never waste a walk to a crowded pool again
            </h2>
            <p className="text-lg text-gray-600 max-w-4xl mx-auto">
              Pool Pulse shows lane busyness using community check-ins so you can plan your swim better.
            </p>
          </div>

          <div className="grid md:grid-cols-3 gap-6 mb-8">
            <div className="text-center">
              <div className="bg-teal-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                <Users className="w-8 h-8 text-teal-600" />
              </div>
              <h3 className="font-bold text-lg mb-2">1. Check Before You Go</h3>
              <p className="text-gray-600 text-sm">See lane busyness estimates</p>
            </div>

            <div className="text-center">
              <div className="bg-cyan-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                <MapPin className="w-8 h-8 text-cyan-600" />
              </div>
              <h3 className="font-bold text-lg mb-2">2. Pick Your Pool</h3>
              <p className="text-gray-600 text-sm">Check opening times & status</p>
            </div>

            <div className="text-center">
              <div className="bg-blue-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                <Droplets className="w-8 h-8 text-blue-600" />
              </div>
              <h3 className="font-bold text-lg mb-2">3. Check In</h3>
              <p className="text-gray-600 text-sm">Takes 2 seconds, helps everyone</p>
            </div>
          </div>

          <div className="text-center">
            <button
              onClick={() => setShowHomepage(false)}
              className="bg-[#043A3D] text-white font-bold px-10 py-4 rounded-xl hover:opacity-90 transition-all shadow-lg text-lg"
            >
              View All Pools and Check in
            </button>
          </div>

          <div className="mt-6 flex flex-wrap items-center justify-center gap-3">
            <button
              onClick={() => document.getElementById("homepage-pools-covered")?.scrollIntoView({ behavior: "smooth", block: "start" })}
              className="px-4 py-2 rounded-full border border-teal-200 text-teal-800 bg-teal-50 text-sm font-semibold hover:bg-teal-100"
            >
              Jump to pools covered
            </button>
            <button
              onClick={() => document.getElementById("homepage-feedback")?.scrollIntoView({ behavior: "smooth", block: "start" })}
              className="px-4 py-2 rounded-full border border-cyan-200 text-cyan-800 bg-cyan-50 text-sm font-semibold hover:bg-cyan-100"
            >
              Jump to feedback
            </button>
          </div>
        </div>

        {/* About Me Section */}
        <div className="bg-white rounded-2xl shadow-xl p-8 mb-8">
          <div className="grid md:grid-cols-3 gap-8 items-center">
            {/* Left side - Image/Avatar */}
           <div className="text-center md:col-span-1">
  <img
    src="./assets/sneha.jpg"
    alt="Sneha"
    className="w-32 h-32 mx-auto rounded-full object-cover shadow-lg border-4 border-white"
  />
  <h3 className="text-xl font-bold text-gray-900 mt-4">Sneha</h3>
  <p className="text-teal-600 font-semibold">Swimmer & Creator</p>
</div>

            {/* Right side - Bio */}
            <div className="md:col-span-2">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">About Pool Pulse</h2>
              <p className="text-gray-700 mb-4 leading-relaxed">
                I'm a swimmer who got tired of wasting trips to crowded pools while training for open water swims in Scotland in 2025. I created <strong>Pool Pulse</strong> to solve this problem with a privacy-first solution that helps the swimming community make smarter decisions.
              </p>
              <p className="text-gray-700 mb-4 leading-relaxed">
                Every swimmer contributes anonymously when they check in. No names, no location tracking, just real-time lane busyness insights that help everyone find the perfect time to swim.
              </p>
              <p className="text-gray-700 leading-relaxed">
                Whether you're training hard, getting a casual swim, or avoiding peak hours, <strong>Pool Pulse</strong> has your back. üåä
              </p>
            </div>
          </div>
        </div>

       {/* Swimming Gallery */}
  <div className="bg-white rounded-2xl shadow-xl p-8 mb-8">
  <h2 className="text-2xl font-bold text-gray-900 mb-4 text-center">
    Why Pool Pulse? 
  </h2>

  <ul className="space-y-3 text-gray-700 max-w-4xl mx-auto">
    <li className="flex gap-3">
      <span className="text-teal-600 font-bold">‚Ä¢</span>
      <span><span className="font-semibold">Smart planning:</span> know lane busyness before you go.</span>
    </li>
    <li className="flex gap-3">
      <span className="text-cyan-600 font-bold">‚Ä¢</span>
      <span><span className="font-semibold">Community-powered:</span> your check-ins help other swimmers.</span>
    </li>
    <li className="flex gap-3">
      <span className="text-blue-600 font-bold">‚Ä¢</span>
      <span><span className="font-semibold">Privacy first:</span> anonymous check-ins, no tracking.</span>
    </li>
  </ul>
</div>
        {/* Pools Covered Section */}
        <div id="homepage-pools-covered" className="bg-white rounded-2xl shadow-xl p-8 mb-8 scroll-mt-24">
          <h2 className="text-2xl font-bold text-gray-900 mb-2">Pools Covered</h2>
          <p className="text-gray-600 mb-6">Currently tracking busyness at {POOLS.length} pools in Edinburgh and Glasgow</p>
          
          <div className="grid md:grid-cols-2 gap-4">
            {POOLS.map((pool) => (
              <div
                key={pool.id}
                className="border-l-4 p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors"
                style={{ borderColor: pool.color }}
              >
                <h3 className="font-bold text-lg text-gray-900 mb-1">{pool.name}</h3>
                <div className="flex items-center gap-1 text-gray-600 text-sm">
                  <MapPin className="w-4 h-4" />
                  <span>{pool.location}</span>
                </div>
                <div className="flex items-center gap-1 text-gray-600 text-sm mt-2">
                  <Clock className="w-4 h-4" />
                  <span className="text-sm">
                    {getOpeningHoursText(pool)}
                  </span>
                </div>
              </div>
            ))}
          </div>

          <div className="bg-teal-50 border-2 border-teal-200 rounded-lg p-4 mt-6">
            <p className="text-teal-900 text-sm">
              <strong>üéØ Pilot Phase:</strong> More pools coming soon!
            </p>
          </div>
        </div>

        {/* Feedback Form */}
        <div id="homepage-feedback" className="bg-white rounded-2xl shadow-xl p-8 mb-8 scroll-mt-24">
          <h2 className="text-2xl font-bold text-gray-900 mb-2">Share feedback</h2>
          <p className="text-gray-600 mb-6">
            Tell us what would make Pool Pulse more useful. Submit your feedback directly here.
          </p>

          <form onSubmit={submitFeedback} className="space-y-4">
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">Type</label>
              <select
                value={feedbackType}
                onChange={(e) => setFeedbackType(e.target.value)}
                className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500"
              >
                <option value="general">General feedback</option>
                <option value="bug">Bug report</option>
                <option value="feature">Feature request</option>
              </select>
            </div>

            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">Message</label>
              <textarea
                value={feedbackMessage}
                onChange={(e) => setFeedbackMessage(e.target.value)}
                placeholder="What could we improve?"
                rows={4}
                required
                className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500"
              />
            </div>

            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">Email (optional)</label>
              <input
                type="email"
                value={feedbackContact}
                onChange={(e) => setFeedbackContact(e.target.value)}
                placeholder="name@example.com"
                className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500"
              />
            </div>

            <button
              type="submit"
              disabled={feedbackSubmitting}
              className="bg-[#043A3D] text-white font-semibold px-6 py-3 rounded-lg hover:opacity-90 transition"
            >
              {feedbackSubmitting ? "Sending..." : "Send feedback"}
            </button>
          </form>

          {feedbackSent && (
            <p className="text-sm text-green-700 mt-4">
              Thanks for your feedback! Your message was sent successfully.
            </p>
          )}

          {feedbackError && (
            <div className="text-sm text-red-700 mt-4 space-y-2">
              <p>{feedbackError}</p>
              {feedbackFallbackHref && (
                <a
                  href={feedbackFallbackHref}
                  className="underline font-medium"
                >
                  Send via email instead
                </a>
              )}
            </div>
          )}
        </div>

        {/* Footer */}
        <div className="mt-12 text-center text-gray-500 text-sm">
          <p>üîí Anonymous check-ins ‚Ä¢ No accounts required ‚Ä¢ Privacy first</p>
          <p className="mt-2">
            Made with üíô by Sneha ‚Ä¢{" "}
            the project maintainer via the Pool Pulse GitHub repository
          </p>

          <p className="mt-4">
            <button
              onClick={() => { setShowHomepage(false); setShowPrivacyPolicy(true); }}
              className="text-gray-500 hover:text-gray-700 underline mr-4"
            >
              Privacy Policy
            </button>
            <button
              onClick={() => { setShowHomepage(false); setShowTerms(true); }}
              className="text-gray-500 hover:text-gray-700 underline"
            >
              Terms of Service
            </button>
          </p>
        </div>
      </div>
    </div>
  );
}

      // -----------------------
      // Loading screen
      // -----------------------
      if (loading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-teal-50 to-cyan-50 flex items-center justify-center">
            <div className="text-center">
              <div className="relative inline-block">
                <Waves className="w-16 h-16 text-teal-500 animate-pulse" />
                <Droplets className="w-8 h-8 text-cyan-500 animate-bounce absolute top-0 right-0" />
              </div>
              <p className="text-gray-600 mt-4">Loading pool data...</p>
            </div>
          </div>
        );
      }

      // -----------------------
      // Pool Detail View
      // -----------------------
      if (viewingPool) {
        const pool = POOLS.find((p) => p.id === viewingPool);
        const poolStatus = getPoolStatus(viewingPool) || buildStatusFromRecent(viewingPool);
        const isOpen = isPoolOpen(pool);
        const hoursText = getOpeningHoursText(pool);

        return (
          <div className="min-h-screen bg-gradient-to-br from-teal-50 to-cyan-50 pb-20">
            <div
              className="bg-[#043A3D] text-white shadow-lg"
            >
              <div className="max-w-4xl mx-auto px-4 py-4">
                <button
                  onClick={() => setViewingPool(null)}
                  className="flex items-center gap-2 text-white/80 hover:text-white mb-3 transition-colors"
                >
                  <ArrowLeft className="w-5 h-5" />
                  Back to all pools
                </button>

                <div className="flex items-center gap-3 mb-2">
                  <div className="relative">
                    <div className="absolute inset-0 bg-white/20 rounded-full blur-md"></div>
                    <div className="relative bg-white/10 backdrop-blur-sm p-2 rounded-2xl border-2 border-white/30">
                      <Waves className="w-7 h-7" />
                    </div>
                  </div>

                  <div>
                    <div className="flex items-center gap-2 mb-1">
                      <h1 className="text-2xl font-bold">{pool.name}</h1>
                      {isOpen ? (
                        <span className="bg-white/20 backdrop-blur-sm text-white text-xs font-bold px-3 py-1 rounded-full border border-white/30">
                          OPEN NOW
                        </span>
                      ) : (
                        <span className="bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full">
                          CLOSED
                        </span>
                      )}
                    </div>

                    <div className="flex items-center gap-1 text-white/90 text-sm mt-1">
                      <MapPin className="w-4 h-4" />
                      <span>{pool.location}</span>
                    </div>

                    <div className="flex items-center gap-1 text-white/80 text-xs mt-1">
                      <Clock className="w-3 h-3" />
                      <span>Today: {hoursText}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div className="max-w-4xl mx-auto px-4 py-6">
              {/* Recent check-ins */}
              <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 className="text-xl font-bold text-gray-900 mb-4">Recent check-ins</h2>

                {checkinsLoading && <div className="text-gray-500">Loading‚Ä¶</div>}
                {checkinsError && <div className="text-red-600">Error: {checkinsError}</div>}

                {!checkinsLoading && !checkinsError && (
                  <div className="space-y-2">
                    {checkinsForPool(pool.id).length === 0 ? (
                      <div className="text-gray-500">No check-ins yet.</div>
                    ) : (
                      checkinsForPool(pool.id).map((c) => (
                        <div key={c.id} className="flex items-center justify-between border rounded-lg p-3">
                          <div>
                            <div className="font-medium">{laneLabel(c.lane)}</div>
                            <div className="text-sm text-gray-600">{formatTime(c.created_at)}</div>
                          </div>
                          <div className="text-sm text-gray-700">+{c.delta ?? 1}</div>
                        </div>
                      ))
                    )}
                  </div>
                )}

                <div className="text-xs text-gray-500 mt-4">
                  Counts in the app are based on check-ins in the last {CHECKIN_WINDOW_MINUTES} minutes.
                </div>
              </div>

              {/* Lane status */}
              {poolStatus ? (
                <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                  <div className="flex items-center gap-2 mb-4">
                    <Activity className="w-5 h-5 text-teal-600" />
                    <h2 className="text-xl font-bold text-gray-900">Current Lane Status</h2>
                  </div>

                  <div className="space-y-4">
                    {LANES.map((lane) => {
                      const laneData = poolStatus.lanes[lane.id];
                      const count = laneData?.checkInCount || 0;
                      const busyness = getLaneBusyness(count);

                      return (
                        <div key={lane.id} className={`border-2 rounded-lg p-4 ${lane.color}`}>
                          <div className="flex items-center justify-between mb-2">
                            <div className="flex items-center gap-2">
                              <span className="text-2xl">{lane.icon}</span>
                              <h3 className="font-bold text-lg">{lane.label}</h3>
                            </div>

                            <div className="flex items-center gap-2">
                              <div className={`${busyness.bgColor} ${busyness.textColor} px-4 py-2 rounded-lg font-bold text-base flex items-center gap-2`}>
                                <span>{busyness.emoji}</span>
                                <span>{busyness.label}</span>
                              </div>

                              <div className="text-white px-3 py-2 rounded-lg font-bold text-sm" style={{ backgroundColor: pool.color }}>
                                {count} check-ins
                              </div>
                            </div>
                          </div>

                          {laneData?.lastUpdate ? (
                            <div className="flex items-center gap-1 text-sm mt-2">
                              <Clock className="w-4 h-4" />
                              <span>Last check-in {getTimeSince(laneData.lastUpdate)}</span>
                            </div>
                          ) : (
                            <p className="text-sm italic opacity-70">No check-ins yet</p>
                          )}
                        </div>
                      );
                    })}
                  </div>

                  <div className="mt-6 pt-6 border-t border-gray-200">
                    <div className="flex items-center justify-between text-sm text-gray-600">
                      <div className="flex items-center gap-1">
                        <Clock className="w-4 h-4" />
                        <span>Last updated {getTimeSince(poolStatus.lastUpdate)}</span>
                      </div>
                      <div className="flex items-center gap-1">
                        <Users className="w-4 h-4" />
                        <span>{poolStatus.totalUpdates} check-ins (last {CHECKIN_WINDOW_MINUTES} mins)</span>
                      </div>
                    </div>
                  </div>
                </div>
              ) : (
                <div className="bg-white rounded-xl shadow-lg p-8 text-center mb-6">
                  <Users className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                  <h3 className="text-xl font-bold text-gray-900 mb-2">No Check-Ins Yet</h3>
                  <p className="text-gray-600">Be the first to check in at this pool!</p>
                </div>
              )}

              <div className="text-center">
                <button
                  onClick={() => { if (!isOpen) return; setSelectedPool(viewingPool); setViewingPool(null); }}
                  disabled={!isOpen}
                  className={"text-white font-bold px-8 py-3 rounded-lg transition-all shadow-md" + (!isOpen ? " opacity-50 cursor-not-allowed" : " hover:opacity-90")}
                  style={{ backgroundColor: pool.color }}
                >
                  {isOpen ? "Check In At This Pool" : "Pool Closed ‚Äî Check-in disabled"}
                </button>
              </div>
            </div>
          </div>
        );
      }

      // -----------------------
      // Main Pool List View
      // -----------------------
      const poolsToShow = POOLS
        .filter((p) => (cityFilter === "All" ? true : cityOf(p) === cityFilter))
        .filter((p) => (openNowOnly ? isPoolOpen(p) : true));

      const showingNoneOpen = openNowOnly && poolsToShow.length === 0;
      const poolsToRender = showingNoneOpen
        ? POOLS.filter((p) => (cityFilter === "All" ? true : cityOf(p) === cityFilter))
        : poolsToShow;

      return (
        <div className="min-h-screen bg-gradient-to-br from-teal-50 to-cyan-50 pb-20">
          <div className="bg-[#043A3D] text-white shadow-lg">
            <div className="max-w-4xl mx-auto px-4 py-6">
              <button
                onClick={() => setShowHomepage(true)}
                className="flex items-center gap-2 text-teal-100 hover:text-white mb-3 transition-colors text-sm"
              >
                <ArrowLeft className="w-4 h-4" />
                Back to home
              </button>

              <div className="flex items-center gap-3 mb-2">
                <div className="relative">
                  <div className="absolute inset-0 bg-white/20 rounded-full blur-lg"></div>
                  <div className="relative bg-white/10 backdrop-blur-sm p-2 rounded-2xl border-2 border-white/30 shadow-xl">
                    <div className="w-10 h-10">
                      <LogoMark />
                    </div>
                  </div>
                </div>
                <div>
                  <h1 className="text-2xl font-bold">Pool Pulse</h1>
                  <p className="text-teal-100 text-xs font-medium">Edinburgh & Glasgow</p>
                </div>
              </div>

              <p className="text-teal-50 text-sm">
                Lane busyness based on anonymous check-ins in the last {CHECKIN_WINDOW_MINUTES} minutes
              </p>
            </div>
          </div>

          {showSuccess && (
            <div className="fixed top-20 left-1/2 transform -translate-x-1/2 bg-teal-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-bounce">
              ‚úì Checked in! Have a great swim
            </div>
          )}

          <div className="max-w-4xl mx-auto px-4 py-6">
            
        {/* Filters */}
        <div className="bg-white rounded-xl shadow-sm p-4 mb-4 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
          <div className="flex items-center gap-4">
            <label className="flex items-center gap-2 text-sm font-semibold text-gray-700">
              <input
                type="checkbox"
                checked={openNowOnly}
                onChange={(e) => setOpenNowOnly(e.target.checked)}
                className="h-4 w-4 accent-teal-600"
              />
              Open now
            </label>

            <div className="text-xs text-gray-500">
              Busyness is based on check-ins from the last {CHECKIN_WINDOW_MINUTES} minutes.
            </div>
          </div>

          <div className="flex items-center gap-2">
            <span className="text-sm text-gray-600">City</span>
            <select
              value={cityFilter}
              onChange={(e) => setCityFilter(e.target.value)}
              className="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-teal-500"
            >
              <option value="All">All</option>
              <option value="Edinburgh">Edinburgh</option>
              <option value="Glasgow">Glasgow</option>
            </select>
          </div>
        </div>

        {showingNoneOpen && (
          <div className="mb-4 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700">
            All pools are closed right now. Showing opening times so you can plan ahead.
          </div>
        )}

<div className="space-y-4 mb-6">
              {poolsToRender.map((pool) => {
                const poolStatus = getPoolStatus(pool.id) || buildStatusFromRecent(pool.id);
                const isOpen = isPoolOpen(pool);
                const hoursText = getOpeningHoursText(pool);

                return (
                  <button
                    type="button"
                    key={pool.id}
                    aria-label={`View details for ${pool.name}`}
                    className="w-full text-left bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-teal-500"
                    onClick={() => setViewingPool(pool.id)}
                    style={{ borderLeft: `6px solid ${pool.color}` }}
                  >
                    <div className="p-5">
                      <div className="flex justify-between items-start mb-3">
                        <div className="flex-1">
                          <div className="flex items-center gap-2 mb-1">
                            <h3 className="font-bold text-lg text-gray-900">{pool.name}</h3>
                            {isOpen ? (
                              <span className="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded-full">OPEN</span>
                            ) : (
                              <span className="bg-red-100 text-red-800 text-xs font-bold px-2 py-1 rounded-full">CLOSED</span>
                            )}
                          </div>

                          <div className="flex items-center gap-1 text-gray-500 text-sm">
                            <MapPin className="w-4 h-4" />
                            <span>{pool.location}</span>
                          </div>

                          <div className="flex items-center gap-1 text-gray-500 text-sm mt-1">
                            <Clock className="w-3 h-3" />
                            <span>{getOpenStatusText(pool)}</span>
                            <span className="text-gray-400">¬∑ Today {hoursText}</span>
                          </div>
                        </div>
                      </div>

                      {(
                        <div className="space-y-3">
                          <div className="grid grid-cols-3 gap-2">
                            {LANES.map((lane) => {
                              const laneData = poolStatus?.lanes?.[lane.id];
                              const count = laneData?.checkInCount || 0;
                              const hasData = !!poolStatus && count > 0;
                              const busyness = hasData ? getLaneBusyness(count) : null;

                              return (
                                <div key={lane.id} className="text-center">
                                  <div className="text-lg mb-1">{lane.icon}</div>

                                  {hasData ? (
                                    <div
                                      className={`${busyness.bgColor} ${busyness.textColor} px-2 py-1 rounded text-sm font-bold flex items-center justify-center gap-1`}
                                    >
                                      <span>{busyness.emoji}</span>
                                      <span>{busyness.label}</span>
                                    </div>
                                  ) : (
                                    <div className="bg-gray-100 text-gray-500 px-2 py-1 rounded text-sm font-bold flex items-center justify-center">
                                      ‚Äî
                                    </div>
                                  )}
                                </div>
                              );
                            })}
                          </div>

                          <div className="flex items-center justify-between text-sm text-gray-500 pt-2 border-t border-gray-100">
                            <div className="flex items-center gap-1">
                              <Clock className="w-4 h-4" />
                              <span>
                                {poolStatus?.lastUpdate
                                  ? `Updated ${getTimeSince(poolStatus.lastUpdate)} ¬∑ ${poolStatus.totalUpdates || 0} check-ins`
                                  : "No recent check-ins yet"}
                              </span>
                            </div>
                            <div className="font-semibold" style={{ color: pool.color }}>
                              View ‚Üí
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  </button>
                );
              })}
            </div>

            {/* Check In box */}
            <div className="bg-white rounded-xl shadow-lg p-6 sticky bottom-4">
              <div className="flex items-center gap-3 mb-4">
                <div className="w-10 h-10 bg-teal-50 border border-teal-100 rounded-xl p-1.5">
                  <LogoMark />
                </div>
                <h2 className="text-xl font-bold text-gray-900">Check In</h2>
              </div>

              <div className="mb-4">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Which pool are you at?
                </label>
                <select
                  value={selectedPool}
                  onChange={(e) => setSelectedPool(e.target.value)}
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-teal-500 focus:outline-none"
                >
                  <option value="">Select a pool...</option>
                  {POOLS.map((pool) => (
                    <option key={pool.id} value={pool.id}>{pool.name}</option>
                  ))}
                </select>
              </div>

              {selectedPool && !selectedPoolIsOpen && (
  <div className="mb-4 p-3 rounded-lg bg-slate-50 border border-slate-200 text-slate-700 text-sm">
    This pool is currently closed ‚Äî check-ins are disabled outside opening hours.
  </div>
)}

              {selectedPool && (
                <div className={"mb-4 animate-fadeIn" + (!selectedPoolIsOpen ? " opacity-50 pointer-events-none" : "")}>
                  <label className="block text-sm font-semibold text-gray-700 mb-3">
                    What lane are you swimming in?
                  </label>
                  <div className="grid grid-cols-3 gap-3">
                    {LANES.map((lane) => (
                      <button
                        key={lane.id}
                        onClick={() => setSelectedLane(lane.id)}
                        className={`p-4 rounded-lg border-2 transition-all ${
                          selectedLane === lane.id
                            ? "border-teal-500 bg-teal-50 shadow-md"
                            : "border-gray-200 hover:border-gray-300"
                        }`}
                      >
                        <div className="text-3xl mb-2">{lane.icon}</div>
                        <div className="font-semibold text-sm text-gray-900">
                          {lane.label.replace(" Lane", "")}
                        </div>
                      </button>
                    ))}
                  </div>
                </div>
              )}

              {selectedPool && selectedLane && selectedPoolIsOpen && (
                <button
                  onClick={handleSubmit}
                  className="w-full bg-[#043A3D] text-white font-bold py-4 rounded-lg hover:opacity-90 transition-all shadow-md mt-4"
                >
                  I'm Swimming Here Now
                </button>
              )}

              {!selectedPool && (
                <p className="text-center text-gray-500 text-sm">
                  Select a pool to get started
                </p>
              )}

              <div className="mt-4 text-xs text-gray-500 text-center">
                Your check-in is anonymous. Please check in honestly ‚ù§Ô∏è
              </div>
            </div>

            <div className="mt-6 text-center text-gray-500 text-sm">
              <p>Community-powered lane tracking for swimmers</p>
              <p className="mt-1">Check in when you arrive ‚Ä¢ See estimated lane busyness</p>
            </div>
          </div>
        </div>
      );
    }

    // Mount the app
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<PoolBusynessTracker />);
  </script>
</body>
</html>
